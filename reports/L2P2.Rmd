---
title: "L2P2"
author: "Erick Santana Rodrigues"
output:
  prettydoc::html_pretty:
    df_print: kable
    theme: cayman
    highlight: github
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE,  warning=FALSE}
library(tidyverse)
library(lubridate)
library(here)

theme_set(theme_bw())

knitr::opts_chunk$set(tidy = FALSE,
                      fig.width = 6,
                      fig.height = 5,
                      echo = TRUE,
                      warning = FALSE,
                      message = FALSE)

buscas = read_csv(here::here("data/search_data.csv.1"))
```

##What is our daily overall clickthrough rate? How does it vary between the groups?

```{r}
buscas %>%
    group_by(date = substr(session_start_date, 1, 10), group) %>%
    mutate(mean_clicks = mean(num_clicks)) %>%
    ggplot(aes(x = date, y = mean_clicks, color = group, group = group)) +
    geom_point(show.legend = FALSE) +
    geom_line() +
    labs(title = "Daily clickthrough rate", x = "", y = "clickthrough rate") +
    theme(axis.text.x = element_text(hjust = 1, angle = 45))
```

##Which results do people tend to try first? How does it change day-to-day?

```{r}
buscas %>%
    filter(first_click < 20) %>%
    group_by(date = substr(session_start_date, 1, 10)) %>%
    ggplot(aes(x = first_click)) +
    geom_bar()
```

```{r}
#95% percentil, desvio padrÃ£o

buscas %>%
    summary(first_click)
    

```


##What is our daily overall zero results rate? How does it vary between the groups?

```{r}
buscas %>%
    group_by(date = substr(session_start_date, 1, 10), group) %>%
    summarise(mean_zero = mean(results == 0)) %>%
    ggplot(aes(x = date, y = mean_zero, color = group, group = group)) +
    geom_point(show.legend = FALSE) +
    geom_line(show.legend = FALSE) +
    labs(title = "Daily overall zero results rate", x = "", y = "zero results %") +
    theme(axis.text.x = element_text(hjust = 1, angle = 45)) +
    facet_wrap(~group)
```

##Let session length be approximately the time between the first event and the last event in a session. Choose a variable from the dataset and describe its relationship to session length. Visualize the relationship.

```{r}

buscas %>%
    filter(session_length != 0) %>%
    group_by(date = substr(session_start_date, 1, 10)) %>%
    ggplot(aes(x = session_length, y = search_index)) +
    geom_point()

```

